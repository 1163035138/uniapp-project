{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\nimport { props } from './props';\nimport { mpMixin } from '../../libs/mixin/mpMixin';\nimport { mixin } from '../../libs/mixin/mixin';\nimport { addUnit, addStyle, deepMerge, getPx, guid, getDeviceInfo, os } from '../../libs/function/index';\nimport zIndex from '../../libs/config/zIndex';\n/**\n * sticky 吸顶\n * @description 该组件与CSS中position: sticky属性实现的效果一致，当组件达到预设的到顶部距离时， 就会固定在指定位置，组件位置大于预设的顶部距离时，会重新按照正常的布局排列。\n * @tutorial https://ijry.github.io/uview-plus/components/sticky.html\n * @property {String ｜ Number}\toffsetTop\t\t吸顶时与顶部的距离，单位px（默认 0 ）\n * @property {String ｜ Number}\tcustomNavHeight\t自定义导航栏的高度 （h5 默认44  其他默认 0 ）\n * @property {Boolean}\t\t\tdisabled\t\t是否开启吸顶功能 （默认 false ）\n * @property {String}\t\t\tbgColor\t\t\t组件背景颜色（默认 '#ffffff' ）\n * @property {String ｜ Number}\tzIndex\t\t\t吸顶时的z-index值\n * @property {String ｜ Number}\tindex\t\t\t自定义标识，用于区分是哪一个组件\n * @property {Object}\t\t\tcustomStyle\t\t组件的样式，对象形式\n * @event {Function} fixed\t\t组件吸顶时触发\n * @event {Function} unfixed\t组件取消吸顶时触发\n * @example <u-sticky offsetTop=\"200\"><view>塞下秋来风景异，衡阳雁去无留意</view></u-sticky>\n */\nexport default defineComponent({\n    name: 'u-sticky',\n    mixins: [mpMixin, mixin, props],\n    data() {\n        return {\n            cssSticky: false,\n            stickyTop: 0,\n            elId: guid(),\n            left: 0,\n            width: 'auto',\n            height: 'auto',\n            fixed: false, // js模式时，是否处于吸顶模式\n        };\n    },\n    computed: {\n        style() {\n            const style = new UTSJSONObject({});\n            if (!this.disabled) {\n                if (this.cssSticky) {\n                    style.position = 'sticky';\n                    style.zIndex = this.uZindex;\n                    style.top = addUnit(this.stickyTop);\n                }\n                else {\n                    style.height = this.fixed ? this.height + 'px' : 'auto';\n                }\n            }\n            else {\n                // 无需吸顶时，设置会默认的relative(nvue)和非nvue的static静态模式即可\n                style.position = 'static';\n            }\n            style.backgroundColor = this.bgColor;\n            return deepMerge(addStyle(this.customStyle), style);\n        },\n        // 吸顶内容的样式\n        stickyContent() {\n            const style = new UTSJSONObject({});\n            if (!this.cssSticky) {\n                style.position = this.fixed ? 'fixed' : 'static';\n                style.top = this.stickyTop + 'px';\n                style.left = this.left + 'px';\n                style.width = this.width == 'auto' ? 'auto' : this.width + 'px';\n                style.zIndex = this.uZindex;\n            }\n            return style;\n        },\n        uZindex() {\n            return this.zIndex ? this.zIndex : zIndex.sticky;\n        }\n    },\n    mounted() {\n        this.init();\n    },\n    watch: {\n        offsetTop(nval = null) {\n            this.getStickyTop();\n        }\n    },\n    methods: {\n        init() {\n            this.getStickyTop();\n            // 判断使用的模式\n            this.checkSupportCssSticky();\n            // 如果不支持css sticky，则使用js方案，此方案性能比不上css方案\n            if (!this.cssSticky) {\n                !this.disabled && this.initObserveContent();\n            }\n        },\n        initObserveContent() {\n            // 获取吸顶内容的高度，用于在js吸顶模式时，给父元素一个填充高度，防止\"塌陷\"\n            this.$uGetRect('#' + this.elId).then((res = null) => {\n                this.height = res.height;\n                this.left = res.left;\n                this.width = res.width;\n                this.$nextTick(() => {\n                    this.observeContent();\n                });\n            });\n        },\n        observeContent() {\n            // 先断掉之前的观察\n            this.disconnectObserver('contentObserver');\n            const contentObserver = uni.createIntersectionObserver(this, {\n                // 检测的区间范围\n                thresholds: [0.95, 0.98, 1]\n            });\n            // 到屏幕顶部的高度时触发\n            contentObserver.relativeToViewport(new UTSJSONObject({\n                top: -this.stickyTop\n            }));\n            // 绑定观察的元素\n            contentObserver.observe(`#${this.elId}`, res => {\n                this.setFixed(res.boundingClientRect.top);\n            });\n            this.contentObserver = contentObserver;\n        },\n        setFixed(top = null) {\n            // 判断是否出于吸顶条件范围\n            const fixed = top <= this.stickyTop;\n            this.fixed = fixed;\n        },\n        disconnectObserver(observerName = null) {\n            // 断掉观察，释放资源\n            const observer = this[observerName];\n            observer && observer.disconnect();\n        },\n        getStickyTop() {\n            this.stickyTop = getPx(this.offsetTop) + getPx(this.customNavHeight);\n        },\n        checkSupportCssSticky() {\n            return __awaiter(this, void 0, void 0, function* () {\n                // 如果安卓版本高于8.0，依然认为是支持css sticky的(因为安卓7在某些机型，可能不支持sticky)\n                if (os() === 'android' && Number(getDeviceInfo().system) > 8) {\n                    this.cssSticky = true;\n                }\n                // APP-Vue和微信平台，通过computedStyle判断是否支持css sticky\n                this.cssSticky = yield this.checkComputedStyle();\n                // ios上，从ios6开始，都是支持css sticky的\n                if (os() === 'ios') {\n                    this.cssSticky = true;\n                }\n                // nvue，是支持css sticky的\n            });\n        },\n        // 在APP和微信小程序上，通过uni.createSelectorQuery可以判断是否支持css sticky\n        checkComputedStyle() {\n            // 方法内进行判断，避免在其他平台生成无用代码\n            return new Promise(resolve => {\n                uni.createSelectorQuery().in(this).select('.u-sticky').fields(new UTSJSONObject({\n                    computedStyle: [\"position\"]\n                })).exec(e => {\n                    resolve('sticky' === e[0].position);\n                });\n            });\n        },\n        // H5通过创建元素的形式嗅探是否支持css sticky\n        // 判断浏览器是否支持sticky属性\n        checkCssStickyForH5() {\n            // 方法内进行判断，避免在其他平台生成无用代码\n        }\n    },\n    beforeUnmount() {\n        this.disconnectObserver('contentObserver');\n    }\n});\n//# sourceMappingURL=C:/Users/86150/Desktop/%E5%BC%A0%E4%BA%9A%E5%86%AC%E9%A1%B9%E7%9B%AE/uniapp-project/uni_modules/uview-plus/components/u-sticky/u-sticky.vue?vue&type=script&lang.uts.js.map","references":["C:/Users/86150/Desktop/张亚冬项目/uniapp-project/uni_modules/uview-plus/components/u-sticky/props.js","C:/Users/86150/Desktop/张亚冬项目/uniapp-project/uni_modules/uview-plus/libs/mixin/mpMixin.js","C:/Users/86150/Desktop/张亚冬项目/uniapp-project/uni_modules/uview-plus/libs/mixin/mixin.js","C:/Users/86150/Desktop/张亚冬项目/uniapp-project/uni_modules/uview-plus/libs/function/index.js","C:/Users/86150/Desktop/张亚冬项目/uniapp-project/uni_modules/uview-plus/libs/config/zIndex.js"],"uniExtApis":["uni.createIntersectionObserver","uni.createSelectorQuery"],"map":"{\"version\":3,\"file\":\"u-sticky.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"u-sticky.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
