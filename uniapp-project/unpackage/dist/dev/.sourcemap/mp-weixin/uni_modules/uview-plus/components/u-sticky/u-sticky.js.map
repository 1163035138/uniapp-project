{"version":3,"file":"u-sticky.js","sources":["uni_modules/uview-plus/components/u-sticky/u-sticky.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/QzovVXNlcnMvODYxNTAvRGVza3RvcC_lvKDkuprlhqzpobnnm64vdW5pYXBwLXByb2plY3QvdW5pX21vZHVsZXMvdXZpZXctcGx1cy9jb21wb25lbnRzL3Utc3RpY2t5L3Utc3RpY2t5LnZ1ZQ"],"sourcesContent":["<template>\n\t<view\n\t\tclass=\"u-sticky\"\n\t\t:style=\"[style]\"\n\t>\n\t\t<view\n\t\t:id=\"elId\"\n\t\t\t:style=\"[stickyContent]\"\n\t\t\tclass=\"u-sticky__content\"\n\t\t>\n\t\t\t<slot />\n\t\t</view>\n\t</view>\n</template>\n\n<script lang=\"uts\">\n\timport { props } from './props';\n\timport { mpMixin } from '../../libs/mixin/mpMixin';\n\timport { mixin } from '../../libs/mixin/mixin';\n\timport { addUnit, addStyle, deepMerge, getPx, guid, getDeviceInfo, os } from '../../libs/function/index';\n\timport zIndex from '../../libs/config/zIndex';\n\t/**\n\t * sticky 吸顶\n\t * @description 该组件与CSS中position: sticky属性实现的效果一致，当组件达到预设的到顶部距离时， 就会固定在指定位置，组件位置大于预设的顶部距离时，会重新按照正常的布局排列。\n\t * @tutorial https://ijry.github.io/uview-plus/components/sticky.html\n\t * @property {String ｜ Number}\toffsetTop\t\t吸顶时与顶部的距离，单位px（默认 0 ）\n\t * @property {String ｜ Number}\tcustomNavHeight\t自定义导航栏的高度 （h5 默认44  其他默认 0 ）\n\t * @property {Boolean}\t\t\tdisabled\t\t是否开启吸顶功能 （默认 false ）\n\t * @property {String}\t\t\tbgColor\t\t\t组件背景颜色（默认 '#ffffff' ）\n\t * @property {String ｜ Number}\tzIndex\t\t\t吸顶时的z-index值\n\t * @property {String ｜ Number}\tindex\t\t\t自定义标识，用于区分是哪一个组件\n\t * @property {Object}\t\t\tcustomStyle\t\t组件的样式，对象形式\n\t * @event {Function} fixed\t\t组件吸顶时触发\n\t * @event {Function} unfixed\t组件取消吸顶时触发\n\t * @example <u-sticky offsetTop=\"200\"><view>塞下秋来风景异，衡阳雁去无留意</view></u-sticky>\n\t */\n\texport default {\n\t\tname: 'u-sticky',\n\t\tmixins: [mpMixin, mixin, props],\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tcssSticky: false, // 是否使用css的sticky实现\n\t\t\t\tstickyTop: 0, // 吸顶的top值，因为可能受自定义导航栏影响，最终的吸顶值非offsetTop值\n\t\t\t\telId: guid(),\n\t\t\t\tleft: 0, // js模式时，吸顶的内容因为处于postition: fixed模式，为了和原来保持一致的样式，需要记录并重新设置它的left，height，width属性\n\t\t\t\twidth: 'auto',\n\t\t\t\theight: 'auto',\n\t\t\t\tfixed: false, // js模式时，是否处于吸顶模式\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tstyle() {\n\t\t\t\tconst style = {}\n\t\t\t\tif(!this.disabled) {\n\t\t\t\t\tif (this.cssSticky) {\n\t\t\t\t\t\tstyle.position = 'sticky'\n\t\t\t\t\t\tstyle.zIndex = this.uZindex\n\t\t\t\t\t\tstyle.top = addUnit(this.stickyTop)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstyle.height = this.fixed ? this.height + 'px' : 'auto'\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// 无需吸顶时，设置会默认的relative(nvue)和非nvue的static静态模式即可\n\n\n\n\n\t\t\t\t\tstyle.position = 'static'\n\n\t\t\t\t}\n\t\t\t\tstyle.backgroundColor = this.bgColor\n\t\t\t\treturn deepMerge(addStyle(this.customStyle), style)\n\t\t\t},\n\t\t\t// 吸顶内容的样式\n\t\t\tstickyContent() {\n\t\t\t\tconst style = {}\n\t\t\t\tif (!this.cssSticky) {\n\t\t\t\t\tstyle.position = this.fixed ? 'fixed' : 'static'\n\t\t\t\t\tstyle.top = this.stickyTop + 'px'\n\t\t\t\t\tstyle.left = this.left + 'px'\n\t\t\t\t\tstyle.width = this.width == 'auto' ? 'auto' : this.width + 'px'\n\t\t\t\t\tstyle.zIndex = this.uZindex\n\t\t\t\t}\n\t\t\t\treturn style\n\t\t\t},\n\t\t\tuZindex() {\n\t\t\t\treturn this.zIndex ? this.zIndex : zIndex.sticky\n\t\t\t}\n\t\t},\n\t\tmounted() {\n\t\t\tthis.init()\n\t\t},\n\t\twatch: {\n\t\t\toffsetTop(nval) {\n\t\t\t\tthis.getStickyTop()\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tinit() {\n\t\t\t\tthis.getStickyTop()\n\t\t\t\t// 判断使用的模式\n\t\t\t\tthis.checkSupportCssSticky()\n\t\t\t\t// 如果不支持css sticky，则使用js方案，此方案性能比不上css方案\n\t\t\t\tif (!this.cssSticky) {\n\t\t\t\t\t!this.disabled && this.initObserveContent()\n\t\t\t\t}\n\t\t\t},\n\t\t\tinitObserveContent() {\n\t\t\t\t// 获取吸顶内容的高度，用于在js吸顶模式时，给父元素一个填充高度，防止\"塌陷\"\n\t\t\t\tthis.$uGetRect('#' + this.elId).then((res) => {\n\t\t\t\t\tthis.height = res.height\n\t\t\t\t\tthis.left = res.left\n\t\t\t\t\tthis.width = res.width\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tthis.observeContent()\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t},\n\t\t\tobserveContent() {\n\t\t\t\t// 先断掉之前的观察\n\t\t\t\tthis.disconnectObserver('contentObserver')\n\t\t\t\tconst contentObserver = uni.createIntersectionObserver(this,{\n\t\t\t\t\t// 检测的区间范围\n\t\t\t\t\tthresholds: [0.95, 0.98, 1]\n\t\t\t\t})\n\t\t\t\t// 到屏幕顶部的高度时触发\n\t\t\t\tcontentObserver.relativeToViewport({\n\t\t\t\t\ttop: -this.stickyTop\n\t\t\t\t})\n\t\t\t\t// 绑定观察的元素\n\t\t\t\tcontentObserver.observe(`#${this.elId}`, res => {\n\t\t\t\t\tthis.setFixed(res.boundingClientRect.top)\n\t\t\t\t})\n\t\t\t\tthis.contentObserver = contentObserver\n\t\t\t},\n\t\t\tsetFixed(top) {\n\t\t\t\t// 判断是否出于吸顶条件范围\n\t\t\t\tconst fixed = top <= this.stickyTop\n\t\t\t\tthis.fixed = fixed\n\t\t\t},\n\t\t\tdisconnectObserver(observerName) {\n\t\t\t\t// 断掉观察，释放资源\n\t\t\t\tconst observer = this[observerName]\n\t\t\t\tobserver && observer.disconnect()\n\t\t\t},\n\t\t\tgetStickyTop() {\n\t\t\t\tthis.stickyTop = getPx(this.offsetTop) + getPx(this.customNavHeight)\n\t\t\t},\n\t\t\tasync checkSupportCssSticky() {\n\n\n\n\n\n\n\n\t\t\t\t// 如果安卓版本高于8.0，依然认为是支持css sticky的(因为安卓7在某些机型，可能不支持sticky)\n\t\t\t\tif (os() === 'android' && Number(getDeviceInfo().system) > 8) {\n\t\t\t\t\tthis.cssSticky = true\n\t\t\t\t}\n\n\t\t\t\t// APP-Vue和微信平台，通过computedStyle判断是否支持css sticky\n\n\t\t\t\tthis.cssSticky = await this.checkComputedStyle()\n\n\n\t\t\t\t// ios上，从ios6开始，都是支持css sticky的\n\t\t\t\tif (os() === 'ios') {\n\t\t\t\t\tthis.cssSticky = true\n\t\t\t\t}\n\n\t\t\t\t// nvue，是支持css sticky的\n\n\n\n\t\t\t},\n\t\t\t// 在APP和微信小程序上，通过uni.createSelectorQuery可以判断是否支持css sticky\n\t\t\tcheckComputedStyle() {\n\t\t\t\t// 方法内进行判断，避免在其他平台生成无用代码\n\n\t\t\t\treturn new Promise(resolve => {\n\t\t\t\t\tuni.createSelectorQuery().in(this).select('.u-sticky').fields({\n\t\t\t\t\t\tcomputedStyle: [\"position\"]\n\t\t\t\t\t}).exec(e => {\n\t\t\t\t\t\tresolve('sticky' === e[0].position)\n\t\t\t\t\t})\n\t\t\t\t})\n\n\t\t\t},\n\t\t\t// H5通过创建元素的形式嗅探是否支持css sticky\n\t\t\t// 判断浏览器是否支持sticky属性\n\t\t\tcheckCssStickyForH5() {\n\t\t\t\t// 方法内进行判断，避免在其他平台生成无用代码\n\n\n\n\n\n\n\n\n\n\n\n\n\t\t\t}\n\t\t},\n\t\tbeforeUnmount() {\n\t\t\tthis.disconnectObserver('contentObserver')\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\" scoped>\n\t.u-sticky {\n\n\t\t// 此处默认写sticky属性，是为了给微信和APP通过uni.createSelectorQuery查询是否支持css sticky使用\n\t\tposition: sticky;\n\n\t}\n</style>\n","import Component from 'C:/Users/86150/Desktop/张亚冬项目/uniapp-project/uni_modules/uview-plus/components/u-sticky/u-sticky.vue'\nwx.createComponent(Component)"],"names":["defineComponent","mpMixin","mixin","props","guid","addUnit","deepMerge","addStyle","zIndex","uni","getPx","os","getDeviceInfo"],"mappings":"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"}